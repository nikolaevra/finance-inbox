# Database Migrations

This directory contains Alembic database migrations for the Finance Inbox application.

## Overview

Alembic is used for database schema version control and migration management. All database schema changes should be made through migrations to ensure consistency across environments.

## Structure

```
migrations/
├── versions/           # Migration files
├── env.py             # Migration environment configuration
├── script.py.mako     # Migration template
└── README             # This file
```

## Usage

### Running Migrations

Apply all pending migrations:
```bash
python3 -m alembic upgrade head
```

Apply a specific migration:
```bash
python3 -m alembic upgrade <revision_id>
```

### Creating Migrations

Generate a migration from model changes:
```bash
python3 -m alembic revision --autogenerate -m "Description of changes"
```

Create an empty migration:
```bash
python3 -m alembic revision -m "Description of changes"
```

### Migration History

View migration history:
```bash
python3 -m alembic history
```

View current migration status:
```bash
python3 -m alembic current
```

### Rolling Back

Downgrade to a specific revision:
```bash
python3 -m alembic downgrade <revision_id>
```

Downgrade one step:
```bash
python3 -m alembic downgrade -1
```

## Configuration

The migration environment is configured in `env.py` to:
- Use environment variables for database connection
- Import all models automatically
- Generate migrations based on model changes

## Best Practices

1. **Always create migrations** for schema changes
2. **Test migrations** in development before production
3. **Use descriptive names** for migration files
4. **Review auto-generated migrations** before applying
5. **Backup database** before running migrations in production

## Troubleshooting

### Migration Conflicts
If you encounter conflicts:
1. Check the current migration state: `alembic current`
2. Review the migration history: `alembic history`
3. Resolve conflicts manually if needed
4. Test the migration in a development environment

### Reset Migrations (Development Only)
⚠️ **WARNING**: This will delete all data!
```bash
python3 -m alembic downgrade base
python3 -m alembic upgrade head
```

## Related Files

- `alembic.ini` - Alembic configuration
- `models.py` - SQLAlchemy models
- `database.py` - Database connection setup